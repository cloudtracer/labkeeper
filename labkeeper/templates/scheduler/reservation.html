{% extends '_base.html' %}
{% load tz %}

{% block content %}
<div class="row">
  <div class="span6">
    <h5 class="muted">Reservation Time</h5>
    <h2>{{ rsv.start_time|localtime }} <small>{{ TIME_ZONE }}</small></h2>
  </div>
  <div class="span4">
    {% if rsv.time_until %}
    <h5 class="muted">Starts in</h5>
    <h2>{{ rsv.time_until }}</h2>
    {% elif not rsv.is_expired %}
    <h5 class="muted">Time remaining</h5>
    <h2 class="text-success">{{ rsv.time_left }}</h2>
    {% else %}
    <h5 class="muted">Starts in</h5>
    <h2 class="text-error">Expired</h2>
    {% endif %}
  </div>
  <div class="span2">
    <h5 class="muted">Duration</h5>
    <h2>{{ rsv.duration }} hour{{ rsv.duration|pluralize }}</h2>
  </div>
</div>

<div class="row">
  <div class="span3">
    <h5 class="muted">Lab</h5>
    <h3><a href="{{ rsv.lab.get_absolute_url }}">{{ rsv.lab }}</a></h3>
    {% ifequal request.user rsv.user %}
    <h5 class="muted">Credentials</h5>
    <div class="well">
      <div class="row-fluid">
        <div class="span6">Username</div>
        <div class="span6">{{ rsv.user }}</div>
      </div>
      <div class="row-fluid">
        <div class="span6">Password</div>
        <div class="span6">{{ rsv.password }}</div>
      </div>
    </div>
    <a href="{% url 'scheduler_delete_reservation' rsv.id %}" class="btn btn-danger" onclick="return confirm('Are you sure you want to cancel this reservation?')">Cancel reservation</a>
    {% endifequal %}
  </div>
  <div class="span9">
  <h5 class="muted">Lab Devices</h5>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Pod</th>
        <th>Name</th>
        <th>Type</th>
        <th>Port</th>
        <th>Telnet</th>
        <th>SSH</th>
      </tr>
    </thead>
    <tbody>
    {% for pod in rsv.pods.all %}
    {% for device in pod.devices.select_related %}
      <tr>
        <td>{{ pod }}</td>
        <td>{{ device.name }}</td>
        <td>{{ device.get_type_display }}</td>
        <td>{{ device.cs_port }}</td>
        <td>{% if device.cs_port.telnet_port %}<a href="telnet://{{ device.cs_port.consoleserver.ip4_address }}:{{ device.cs_port.telnet_port }}/">{{ device.cs_port.telnet_port }}</a>{% endif %}</td>
        <td>{% if device.cs_port.ssh_port %}<a href="ssh://{{ device.cs_port.consoleserver.ip4_address }}:{{ device.cs_port.ssh_port }}/">{{ device.cs_port.ssh_port }}</a>{% endif %}</td>
      </tr>
    {% endfor %}
    {% endfor %}
    </tbody>
  </table>
  <h3 class="text-center"><a href="{{ rsv.lab.get_absolute_url }}">More lab info</a></h3>
  </div>
</div>
{% endblock %}
